#!/bin/bash
# Hyper E: Cycle size (float) / Move up (tiled)
# Float cycle: almost-maximize ↔ maximize

LAYOUT=$(/opt/homebrew/bin/aerospace list-windows --focused --format '%{window-layout}')

if [ "$LAYOUT" != "floating" ]; then
  /opt/homebrew/bin/aerospace move up
  exit 0
fi

# Detect actual size and cycle: not-almost-max → almost-max, almost-max → maximize
/opt/homebrew/bin/hs -c '
  local w = hs.window.focusedWindow()
  if not w then return end
  local prev = hs.window.animationDuration
  hs.window.animationDuration = 0
  local s = w:screen():frame()
  local f = w:frame()

  local almostW, almostH = s.w * 0.90, s.h * 0.90
  local isAlmost = math.abs(f.w - almostW) < 20 and math.abs(f.h - almostH) < 20

  if isAlmost then
    w:setFrame(s)
  else
    local fw, fh = almostW, almostH
    w:setFrame(hs.geometry.rect(s.x + (s.w - fw) / 2, s.y + (s.h - fh) / 2, fw, fh))
  end
  hs.window.animationDuration = prev
'
